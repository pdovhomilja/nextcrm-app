commit 00b871f4dfde7bd254fa1c6cd5352136830b069c
Author: google-labs-jules[bot] <161369871+google-labs-jules[bot]@users.noreply.github.com>
Date:   Wed Nov 5 05:02:28 2025 +0000

    feat: Implement AWMS Phase 1 Modules

    This commit implements the backend for the core AWMS modules as specified in Phase 1 of the PRD.

    This includes:
    - Extending the Prisma schema with models for customers, vehicles, services, quotes, and appointments.
    - Adding basic API endpoints for creating and fetching these resources.
    - Writing new Cypress API tests to verify the functionality of the customer and vehicle endpoints.
    - Correcting various linting errors across the codebase.

diff --git a/app/[locale]/(auth)/accept-invitation/[token]/page.tsx b/app/[locale]/(auth)/accept-invitation/[token]/page.tsx
index 35bcde6..36b8b5a 100644
--- a/app/[locale]/(auth)/accept-invitation/[token]/page.tsx
+++ b/app/[locale]/(auth)/accept-invitation/[token]/page.tsx
@@ -141,7 +141,7 @@ export default function AcceptInvitationPage({
                   This is a one-time token that expires in 7 days
                 </li>
                 <li>
-                  Once accepted, you'll be added to the organization
+                  Once accepted, you&apos;ll be added to the organization
                 </li>
                 <li>
                   Your role and permissions will be set by the organization owner
diff --git a/app/[locale]/(routes)/settings/team/components/PendingInvitations.tsx b/app/[locale]/(routes)/settings/team/components/PendingInvitations.tsx
index c50fc30..dcce954 100644
--- a/app/[locale]/(routes)/settings/team/components/PendingInvitations.tsx
+++ b/app/[locale]/(routes)/settings/team/components/PendingInvitations.tsx
@@ -1,6 +1,6 @@
 "use client";

-import { useEffect, useState } from "react";
+import { useEffect, useState, useCallback } from "react";
 import { getInvitations, PendingInvitation } from "@/actions/organization/get-invitations";
 import {
   Table,
@@ -22,11 +22,7 @@ export function PendingInvitations() {
   const [cancelling, setCancelling] = useState<string | null>(null);
   const { toast } = useToast();

-  useEffect(() => {
-    loadInvitations();
-  }, []);
-
-  const loadInvitations = async () => {
+  const loadInvitations = useCallback(async () => {
     try {
       setLoading(true);
       const data = await getInvitations();
@@ -40,7 +36,11 @@ export function PendingInvitations() {
     } finally {
       setLoading(false);
     }
-  };
+  }, [toast]);
+
+  useEffect(() => {
+    loadInvitations();
+  }, [loadInvitations]);

   const handleCancelInvitation = async (invitationId: string) => {
     try {
diff --git a/app/[locale]/(routes/)/settings/usage/page.tsx b/app/[locale]/(routes/)/settings/usage/page.tsx
index d07c8dc..c0ef6d0 100644
--- a/app/[locale]/(routes/)/settings/usage/page.tsx
+++ b/app/[locale]/(routes/)/settings/usage/page.tsx
@@ -163,7 +163,7 @@ export default function UsagePage() {
       <div>
         <h1 className="text-3xl font-bold tracking-tight">Usage & Limits</h1>
         <p className="text-muted-foreground mt-1">
-          Monitor your organization's resource usage and plan limits.
+          Monitor your organization&apos;s resource usage and plan limits.
         </p>
       </div>

@@ -173,7 +173,7 @@ export default function UsagePage() {
           <div className="flex items-center justify-between">
             <div>
               <CardTitle>Current Plan</CardTitle>
-              <CardDescription>Your organization's subscription tier</CardDescription>
+              <CardDescription>Your organization&apos;s subscription tier</CardDescription>
             </div>
             <Badge variant="outline" className="text-lg px-3 py-1">
               {planName}
diff --git a/app/api/awms/appointments/route.ts b/app/api/awms/appointments/route.ts
new file mode 100644
index 0000000..ac9ed00
--- /dev/null
+++ b/app/api/awms/appointments/route.ts
@@ -0,0 +1,71 @@
+import { NextRequest, NextResponse } from 'next/server';
+import { PrismaClient } from '@prisma/client';
+import { z } from 'zod';
+
+const prisma = new PrismaClient();
+
+const createAppointmentSchema = z.object({
+  organizationId: z.string().min(1, 'Organization ID is required'),
+  customer_id: z.string().min(1, 'Customer ID is required'),
+  vehicle_id: z.string().min(1, 'Vehicle ID is required'),
+  service_type_id: z.string().min(1, 'Service type ID is required'),
+  appointment_date_time: z.string().datetime(),
+  duration_minutes: z.number(),
+});
+
+export async function GET(req: NextRequest) {
+  try {
+    const { searchParams } = new URL(req.url);
+    const vehicleId = searchParams.get('vehicleId');
+
+    if (!vehicleId) {
+      return NextResponse.json({ error: 'Vehicle ID is required' }, { status: 400 });
+    }
+
+    const appointments = await prisma.awms_appointments.findMany({
+      where: { vehicle_id: vehicleId },
+    });
+
+    return NextResponse.json(appointments);
+  } catch (error) {
+    console.error('Error fetching appointments:', error);
+    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
+  }
+}
+
+export async function POST(req: NextRequest) {
+  try {
+    const body = await req.json();
+    const validation = createAppointmentSchema.safeParse(body);
+
+    if (!validation.success) {
+      return NextResponse.json({ error: validation.error.errors }, { status: 400 });
+    }
+
+    const {
+      organizationId,
+      customer_id,
+      vehicle_id,
+      service_type_id,
+      appointment_date_time,
+      duration_minutes,
+    } = validation.data;
+
+    const newAppointment = await prisma.awms_appointments.create({
+      data: {
+        organizationId,
+        customer_id,
+        vehicle_id,
+        service_type_id,
+        appointment_date_time: new Date(appointment_date_time),
+        duration_minutes,
+        status: 'SCHEDULED',
+      },
+    });
+
+    return NextResponse.json(newAppointment, { status: 201 });
+  } catch (error) {
+    console.error('Error creating appointment:', error);
+    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
+  }
+}
diff --git a/app/api/awms/customers/route.ts b/app/api/awms/customers/route.ts
new file mode 100644
index 0000000..b66fcd4
--- /dev/null
+++ b/app/api/awms/customers/route.ts
@@ -0,0 +1,88 @@
+import { NextRequest, NextResponse } from 'next/server';
+import { PrismaClient } from '@prisma/client';
+import { z } from 'zod';
+
+const prisma = new PrismaClient();
+
+const createCustomerSchema = z.object({
+  first_name: z.string().min(1, 'First name is required'),
+  last_name: z.string().min(1, 'Last name is required'),
+  email: z.string().email('Invalid email address'),
+  phone_primary: z.string().optional(),
+  organizationId: z.string().min(1, 'Organization ID is required'),
+  created_by_id: z.string().min(1, 'Created by ID is required'),
+  customer_number: z.string().min(1, 'Customer number is required'),
+});
+
+export async function GET(req: NextRequest) {
+  try {
+    const { searchParams } = new URL(req.url);
+    const organizationId = searchParams.get('organizationId');
+
+    if (!organizationId) {
+      return NextResponse.json({ error: 'Organization ID is required' }, { status: 400 });
+    }
+
+    const customers = await prisma.awms_customers.findMany({
+      where: { organizationId },
+    });
+
+    return NextResponse.json(customers);
+  } catch (error) {
+    console.error('Error fetching customers:', error);
+    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
+  }
+}
+
+export async function POST(req: NextRequest) {
+  try {
+    const body = await req.json();
+    const validation = createCustomerSchema.safeParse(body);
+
+    if (!validation.success) {
+      return NextResponse.json({ error: validation.error.errors }, { status: 400 });
+    }
+
+    const {
+      first_name,
+      last_name,
+      email,
+      phone_primary,
+      organizationId,
+      created_by_id,
+      customer_number
+    } = validation.data;
+
+    // Check for existing customer with the same email in the same organization
+    const existingCustomer = await prisma.awms_customers.findFirst({
+      where: {
+        organizationId,
+        email,
+      },
+    });
+
+    if (existingCustomer) {
+      return NextResponse.json({ error: 'A customer with this email already exists' }, { status: 409 });
+    }
+
+    const newCustomer = await prisma.awms_customers.create({
+      data: {
+        first_name,
+        last_name,
+        email,
+        phone_primary,
+        organizationId,
+        created_by_id,
+        customer_number,
+        status: 'NEW',
+        lifecycle_stage: 'CUSTOMER',
+        contact_preference: 'EMAIL',
+      },
+    });
+
+    return NextResponse.json(newCustomer, { status: 201 });
+  } catch (error) {
+    console.error('Error creating customer:', error);
+    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
+  }
+}
diff --git a/app/api/awms/quotes/route.ts b/app/api/awms/quotes/route.ts
new file mode 100644
index 0000000..940218f
--- /dev/null
+++ b/app/api/awms/quotes/route.ts
@@ -0,0 +1,77 @@
+import { NextRequest, NextResponse } from 'next/server';
+import { PrismaClient } from '@prisma/client';
+import { z } from 'zod';
+
+const prisma = new PrismaClient();
+
+const createQuoteSchema = z.object({
+  organizationId: z.string().min(1, 'Organization ID is required'),
+  customer_id: z.string().min(1, 'Customer ID is required'),
+  vehicle_id: z.string().min(1, 'Vehicle ID is required'),
+  quote_number: z.string().min(1, 'Quote number is required'),
+  subtotal: z.number(),
+  tax_amount: z.number(),
+  total_amount: z.number(),
+});
+
+export async function GET(req: NextRequest) {
+  try {
+    const { searchParams } = new URL(req.url);
+    const customerId = searchParams.get('customerId');
+
+    if (!customerId) {
+      return NextResponse.json({ error: 'Customer ID is required' }, { status: 400 });
+    }
+
+    const quotes = await prisma.awms_quotes.findMany({
+      where: { customer_id: customerId },
+    });
+
+    return NextResponse.json(quotes);
+  } catch (error) {
+    console.error('Error fetching quotes:', error);
+    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
+  }
+}
+
+export async function POST(req: NextRequest) {
+  try {
+    const body = await req.json();
+    const validation = createQuoteSchema.safeParse(body);
+
+    if (!validation.success) {
+      return NextResponse.json({ error: validation.error.errors }, { status: 400 });
+    }
+
+    const {
+      organizationId,
+      customer_id,
+      vehicle_id,
+      quote_number,
+      subtotal,
+      tax_amount,
+      total_amount,
+    } = validation.data;
+
+    const newQuote = await prisma.awms_quotes.create({
+      data: {
+        organizationId,
+        customer_id,
+        vehicle_id,
+        quote_number,
+        subtotal,
+        tax_amount,
+        total_amount,
+        status: 'DRAFT',
+      },
+    });
+
+    return NextResponse.json(newQuote, { status: 201 });
+  } catch (error) {
+    console.error('Error creating quote:', error);
+    if (error.code === 'P2002' && error.meta?.target?.includes('quote_number')) {
+      return NextResponse.json({ error: 'A quote with this number already exists' }, { status: 409 });
+    }
+    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
+  }
+}
diff --git a/app/api/awms/services/route.ts b/app/api/awms/services/route.ts
new file mode 100644
index 0000000..cd0a10b
--- /dev/null
+++ b/app/api/awms/services/route.ts
@@ -0,0 +1,76 @@
+import { NextRequest, NextResponse } from 'next/server';
+import { PrismaClient } from '@prisma/client';
+import { z } from 'zod';
+
+const prisma = new PrismaClient();
+
+const createServiceJobSchema = z.object({
+  organizationId: z.string().min(1, 'Organization ID is required'),
+  customer_id: z.string().min(1, 'Customer ID is required'),
+  vehicle_id: z.string().min(1, 'Vehicle ID is required'),
+  service_type_id: z.string().min(1, 'Service type ID is required'),
+  job_number: z.string().min(1, 'Job number is required'),
+  customer_concerns: z.string().optional(),
+});
+
+export async function GET(req: NextRequest) {
+  try {
+    const { searchParams } = new URL(req.url);
+    const vehicleId = searchParams.get('vehicleId');
+
+    if (!vehicleId) {
+      return NextResponse.json({ error: 'Vehicle ID is required' }, { status: 400 });
+    }
+
+    const serviceJobs = await prisma.awms_service_jobs.findMany({
+      where: { vehicle_id: vehicleId },
+    });
+
+    return NextResponse.json(serviceJobs);
+  } catch (error) {
+    console.error('Error fetching service jobs:', error);
+    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
+  }
+}
+
+export async function POST(req: NextRequest) {
+  try {
+    const body = await req.json();
+    const validation = createServiceJobSchema.safeParse(body);
+
+    if (!validation.success) {
+      return NextResponse.json({ error: validation.error.errors }, { status: 400 });
+    }
+
+    const {
+      organizationId,
+      customer_id,
+      vehicle_id,
+      service_type_id,
+      job_number,
+      customer_concerns,
+    } = validation.data;
+
+    const newServiceJob = await prisma.awms_service_jobs.create({
+      data: {
+        organizationId,
+        customer_id,
+        vehicle_id,
+        service_type_id,
+        job_number,
+        customer_concerns,
+        status: 'NEW',
+        priority: 'ROUTINE',
+        quality_check_status: 'PENDING',
+      },
+    });
+
+    return NextResponse.json(newServiceJob, { status: 201 });
+  } catch (error) {
+    console.error('Error creating service job:', error);
+    if (error.code === 'P2002' && error.meta?.target?.includes('job_number')) {
+      return NextResponse.json({ error: 'A service job with this job number already exists' }, { status: 409 });
+    }
+    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
+  }
+}
diff --git a/app/api/awms/test-setup/route.ts b/app/api/awms/test-setup/route.ts
new file mode 100644
index 0000000..84ff1e6
--- /dev/null
+++ b/app/api/awms/test-setup/route.ts
@@ -0,0 +1,32 @@
+import { NextRequest, NextResponse } from 'next/server';
+import { PrismaClient } from '@prisma/client';
+
+const prisma = new PrismaClient();
+
+export async function POST(req: NextRequest) {
+  try {
+    const { orgName, userName, userEmail } = await req.json();
+
+    // First, create a user who will be the owner
+    const user = await prisma.users.create({
+      data: {
+        name: userName,
+        email: userEmail,
+      },
+    });
+
+    // Then, create the organization
+    const organization = await prisma.organizations.create({
+      data: {
+        name: orgName,
+        slug: orgName.toLowerCase().replace(/\s+/g, '-'),
+        ownerId: user.id,
+      },
+    });
+
+    return NextResponse.json({ user, organization });
+  } catch (error) {
+    console.error('Error in test setup:', error);
+    return NextResponse.json({ error: 'Internal Server Error', details: error.message }, { status: 500 });
+  }
+}
diff --git a/app/api/awms/vehicles/route.ts b/app/api/awms/vehicles/route.ts
new file mode 100644
index 0000000..2a9b506
--- /dev/null
+++ b/app/api/awms/vehicles/route.ts
@@ -0,0 +1,80 @@
+import { NextRequest, NextResponse } from 'next/server';
+import { PrismaClient } from '@prisma/client';
+import { z } from 'zod';
+
+const prisma = new PrismaClient();
+
+const createVehicleSchema = z.object({
+  organizationId: z.string().min(1, 'Organization ID is required'),
+  customer_id: z.string().min(1, 'Customer ID is required'),
+  vehicle_number: z.string().min(1, 'Vehicle number is required'),
+  registration_number: z.string().min(1, 'Registration number is required'),
+  created_by_id: z.string().min(1, 'Created by ID is required'),
+  make: z.string().optional(),
+  model: z.string().optional(),
+  year: z.number().optional(),
+});
+
+export async function GET(req: NextRequest) {
+  try {
+    const { searchParams } = new URL(req.url);
+    const customerId = searchParams.get('customerId');
+
+    if (!customerId) {
+      return NextResponse.json({ error: 'Customer ID is required' }, { status: 400 });
+    }
+
+    const vehicles = await prisma.awms_vehicles.findMany({
+      where: { customer_id: customerId },
+    });
+
+    return NextResponse.json(vehicles);
+  } catch (error) {
+    console.error('Error fetching vehicles:', error);
+    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
+  }
+}
+
+export async function POST(req: NextRequest) {
+  try {
+    const body = await req.json();
+    const validation = createVehicleSchema.safeParse(body);
+
+    if (!validation.success) {
+      return NextResponse.json({ error: validation.error.errors }, { status: 400 });
+    }
+
+    const {
+      organizationId,
+      customer_id,
+      vehicle_number,
+      registration_number,
+      created_by_id,
+      make,
+      model,
+      year,
+    } = validation.data;
+
+    const newVehicle = await prisma.awms_vehicles.create({
+      data: {
+        organizationId,
+        customer_id,
+        vehicle_number,
+        registration_number,
+        created_by_id,
+        make,
+        model,
+        year,
+        status: 'ACTIVE',
+      },
+    });
+
+    return NextResponse.json(newVehicle, { status: 201 });
+  } catch (error) {
+    console.error('Error creating vehicle:', error);
+    if (error.code === 'P2002' && error.meta?.target?.includes('registration_number')) {
+      return NextResponse.json({ error: 'A vehicle with this registration number already exists' }, { status: 409 });
+    }
+    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
+  }
+}
diff --git a/cypress/e2e/3-awms/crm-customers.cy.ts b/cypress/e2e/3-awms/crm-customers.cy.ts
new file mode 100644
index 0000000..e6f2ab1
--- /dev/null
+++ b/cypress/e2e/3-awms/crm-customers.cy.ts
@@ -0,0 +1,44 @@
+describe('AWMS CRM Customers API', () => {
+  let organizationId;
+  let userId;
+
+  beforeEach(() => {
+    const orgName = `Test Org ${Date.now()}`;
+    const userName = 'Test User';
+    const userEmail = `test.user.${Date.now()}@example.com`;
+
+    cy.request('POST', '/api/awms/test-setup', {
+      orgName,
+      userName,
+      userEmail,
+    }).then((response) => {
+      cy.wrap(response.body.organization.id).as('organizationId');
+      cy.wrap(response.body.user.id).as('userId');
+    });
+  });
+
+  it('should create a new customer', function () {
+    const customer = {
+      first_name: 'John',
+      last_name: 'Doe',
+      email: `john.doe.${Date.now()}@example.com`,
+      phone_primary: '123-456-7890',
+      organizationId: this.organizationId,
+      created_by_id: this.userId,
+      customer_number: `CUST-${Date.now()}`,
+    };
+
+    cy.request('POST', '/api/awms/customers', customer).then((response) => {
+      expect(response.status).to.eq(201);
+      expect(response.body).to.have.property('id');
+      expect(response.body.first_name).to.eq(customer.first_name);
+    });
+  });
+
+  it('should fetch customers for an organization', function () {
+    cy.request('GET', `/api/awms/customers?organizationId=${this.organizationId}`).then((response) => {
+      expect(response.status).to.eq(200);
+      expect(response.body).to.be.an('array');
+    });
+  });
+});
diff --git a/cypress/e2e/3-awms/crm-vehicles.cy.ts b/cypress/e2e/3-awms/crm-vehicles.cy.ts
new file mode 100644
index 0000000..ec8b039
--- /dev/null
+++ b/cypress/e2e/3-awms/crm-vehicles.cy.ts
@@ -0,0 +1,61 @@
+describe('AWMS Vehicles API', () => {
+  let organizationId;
+  let customerId;
+  let userId;
+
+  beforeEach(() => {
+    const orgName = `Test Org ${Date.now()}`;
+    const userName = 'Test User';
+    const userEmail = `test.user.${Date.now()}@example.com`;
+
+    cy.request('POST', '/api/awms/test-setup', {
+      orgName,
+      userName,
+      userEmail,
+    }).then((response) => {
+      cy.wrap(response.body.organization.id).as('organizationId');
+      cy.wrap(response.body.user.id).as('userId');
+
+      const customer = {
+        first_name: 'Jane',
+        last_name: 'Doe',
+        email: `jane.doe.${Date.now()}@example.com`,
+        organizationId: response.body.organization.id,
+        created_by_id: response.body.user.id,
+        customer_number: `CUST-${Date.now()}`,
+      };
+
+      cy.request('POST', '/api/awms/customers', customer).then(
+        (customerResponse) => {
+          cy.wrap(customerResponse.body.id).as('customerId');
+        }
+      );
+    });
+  });
+
+  it('should create a new vehicle', function () {
+    const vehicle = {
+      organizationId: this.organizationId,
+      customer_id: this.customerId,
+      vehicle_number: `VEH-${Date.now()}`,
+      registration_number: `REG-${Date.now()}`,
+      created_by_id: this.userId,
+      make: 'Toyota',
+      model: 'Camry',
+      year: 2021,
+    };
+
+    cy.request('POST', '/api/awms/vehicles', vehicle).then((response) => {
+      expect(response.status).to.eq(201);
+      expect(response.body).to.have.property('id');
+      expect(response.body.make).to.eq(vehicle.make);
+    });
+  });
+
+  it('should fetch vehicles for a customer', function () {
+    cy.request('GET', `/api/awms/vehicles?customerId=${this.customerId}`).then((response) => {
+      expect(response.status).to.eq(200);
+      expect(response.body).to.be.an('array');
+    });
+  });
+});
diff --git a/mongod.conf.tmp b/mongod.conf.tmp
new file mode 100644
index 0000000..413f60e
--- /dev/null
+++ b/mongod.conf.tmp
@@ -0,0 +1,38 @@
+# mongod.conf
+
+# for documentation of all options, see:
+#   http://docs.mongodb.org/manual/reference/configuration-options/
+
+# Where and how to store data.
+storage:
+  dbPath: /var/lib/mongodb
+#  engine:
+#  wiredTiger:
+
+# where to write logging data.
+systemLog:
+  destination: file
+  logAppend: true
+  path: /var/log/mongodb/mongod.log
+
+# network interfaces
+net:
+  port: 27017
+  bindIp: 127.0.0.1
+
+# how the process runs
+processManagement:
+  timeZoneInfo: /usr/share/zoneinfo
+
+#security:
+
+#operationProfiling:
+
+replication:
+  replSetName: "rs0"
+
+#sharding:
+
+## Enterprise-Only Options:
+
+#auditLog:
diff --git a/next.log b/next.log
new file mode 100644
index 0000000..973e8c1
--- /dev/null
+++ b/next.log
@@ -0,0 +1,17 @@
+
+> nextcrm-app@0.0.3-beta dev /app
+> next dev
+
+ ⚠ Port 3000 is in use, trying 3001 instead.
+ ⚠ Port 3001 is in use, trying 3002 instead.
+ ⚠ Port 3002 is in use, trying 3003 instead.
+ ⚠ Port 3003 is in use, trying 3004 instead.
+ ⚠ Port 3004 is in use, trying 3005 instead.
+ ⚠ Port 3005 is in use, trying 3006 instead.
+   ▲ Next.js 15.2.4
+   - Local:        http://localhost:3006
+   - Network:      http://192.168.0.2:3006
+   - Environments: .env
+
+ ✓ Starting...
+ ✓ Ready in 3.5s
diff --git a/pnpm-lock.yaml b/pnpm-lock.yaml
index bfdb296..e291feb 100644
--- a/pnpm-lock.yaml
+++ b/pnpm-lock.yaml
@@ -156,6 +156,9 @@ importers:
       imap:
         specifier: ^0.8.19
         version: 0.8.19
+      ioredis:
+        specifier: ^5.4.1
+        version: 5.8.2
       jotai:
         specifier: ^2.10.2
         version: 2.10.2(react@19.0.0-rc-66855b96-20241106)(types-react@19.0.0-rc.1)
@@ -274,6 +277,9 @@ importers:
       '@types/imap':
         specifier: ^0.8.42
         version: 0.8.42
+      '@types/ioredis':
+        specifier: ^5.0.0
+        version: 5.0.0
       '@types/mailparser':
         specifier: ^3.4.5
         version: 3.4.5
@@ -913,6 +919,9 @@ packages:
     cpu: [x64]
     os: [win32]

+  '@ioredis/commands@1.4.0':
+    resolution: {integrity: sha512-aFT2yemJJo+TZCmieA7qnYGQooOS7QfNmYrzGtsYd3g9j5iDP8AimYYAesf79ohjbLG12XxC4nG5DyEnC88AsQ==}
+
   '@isaacs/cliui@8.0.2':
     resolution: {integrity: sha512-O8jcjabXaleOG9DQ0+ARXWZBTfnP4WNAqzuiJK7ll44AmxGKv/J2M4TPjxjY3znBCfvBXFzucm1twdyFybFqEA==}
     engines: {node: '>=12'}
@@ -2038,6 +2047,10 @@ packages:
   '@types/imap@0.8.42':
     resolution: {integrity: sha512-FusePG9Cp2GYN6OLow9xBCkjznFkAR7WCz0Fm+j1p/ER6C8V8P71DtjpSmwrZsS7zekCeqdTPHEk9N5OgPwcsg==}

+  '@types/ioredis@5.0.0':
+    resolution: {integrity: sha512-zJbJ3FVE17CNl5KXzdeSPtdltc4tMT3TzC6fxQS0sQngkbFZ6h+0uTafsRqu+eSLIugf6Yb0Ea0SUuRr42Nk9g==}
+    deprecated: This is a stub types definition. ioredis provides its own type definitions, so you do not need this installed.
+
   '@types/json-schema@7.0.15':
     resolution: {integrity: sha512-5+fP8P8MFNC+AyZCDxrB2pkZFPGzqQWUzpSeuuVLvm8VMcorNYavBqoFcxK8bQz4Qsbn4oUEEem4wDLfcysGHA==}

@@ -2573,6 +2586,10 @@ packages:
     resolution: {integrity: sha512-eYm0QWBtUrBWZWG0d386OGAw16Z995PiOVo2B7bjWSbHedGl5e0ZWaq65kOGgUSNesEIDkB9ISbTg/JK9dhCZA==}
     engines: {node: '>=6'}

+  cluster-key-slot@1.1.2:
+    resolution: {integrity: sha512-RMr0FhtfXemyinomL4hrWcYJxmX6deFdCxpJzhDttxgO1+bcCnkk+9drydLVDmAMG7NE6aN/fl4F7ucU/90gAA==}
+    engines: {node: '>=0.10.0'}
+
   cmdk@1.0.4:
     resolution: {integrity: sha512-AnsjfHyHpQ/EFeAnG216WY7A5LiYCoZzCSygiLvfXC3H3LFGCprErteUcszaVluGOhuOTbJS3jWHrSDYPBBygg==}
     peerDependencies:
@@ -2832,6 +2849,10 @@ packages:
   delegates@1.0.0:
     resolution: {integrity: sha512-bd2L678uiWATM6m5Z1VzNCErI3jiGzt6HGY8OVICs40JQq/HALfbyNJmp0UDakEY4pMMaN0Ly5om/B1VI/+xfQ==}

+  denque@2.1.0:
+    resolution: {integrity: sha512-HVQE3AAb/pxF8fQAoiqpvg9i3evqug3hoiwakOyZAwJm+6vZehbkYXZ0l4JxS+I3QxM97v5aaRNhj8v5oBhekw==}
+    engines: {node: '>=0.10'}
+
   dequal@2.0.3:
     resolution: {integrity: sha512-0je+qPKHEMohvfRTCEo3CrPG6cAzAYgmzKyxRiYSSDkS6eGJdyVJm7WaYA5ECaAD9wLB2T4EEeymA5aFVcYXCA==}
     engines: {node: '>=6'}
@@ -3493,6 +3514,10 @@ packages:
   invariant@2.2.4:
     resolution: {integrity: sha512-phJfQVBuaJM5raOpJjSfkiD6BpbCE4Ns//LaXl6wGYtUBY83nWS6Rf9tXm2e8VaK60JEjYldbPif/A2B1C2gNA==}

+  ioredis@5.8.2:
+    resolution: {integrity: sha512-C6uC+kleiIMmjViJINWk80sOQw5lEzse1ZmvD+S/s8p8CWapftSaC+kocGTx6xrbrJ4WmYQGC08ffHLr6ToR6Q==}
+    engines: {node: '>=12.22.0'}
+
   is-array-buffer@3.0.4:
     resolution: {integrity: sha512-wcjaerHw0ydZwfhiKbXJWLDY8A7yV7KhjQOpb83hGgGfId/aQa4TOvwyzn2PuswW2gPCYEL/nEAiSVpdOj1lXw==}
     engines: {node: '>= 0.4'}
@@ -3820,6 +3845,12 @@ packages:
     resolution: {integrity: sha512-iPZK6eYjbxRu3uB4/WZ3EsEIMJFMqAoopl3R+zuq0UjcAm/MO6KCweDgPfP3elTztoKP3KtnVHxTn2NHBSDVUw==}
     engines: {node: '>=10'}

+  lodash.defaults@4.2.0:
+    resolution: {integrity: sha512-qjxPLHd3r5DnsdGacqOMU6pb/avJzdh9tFX2ymgoZE27BmjXrNy/y4LoaiTeAb+O3gL8AfpJGtqfX/ae2leYYQ==}
+
+  lodash.isarguments@3.1.0:
+    resolution: {integrity: sha512-chi4NHZlZqZD18a0imDHnZPrDeBbTtVN7GXMwuGdRH9qotxAjYs3aVLKc7zNOG9eddR5Ksd8rvFEBc9SsggPpg==}
+
   lodash.merge@4.6.2:
     resolution: {integrity: sha512-0KpjqXRVvrYyCsX1swR/XTK0va6VQkQM6MNo7PqW77ByjAhoARA8EfrP1N4+KlKj8YS0ZUCtRT/YUuhyYDujIQ==}

@@ -4604,6 +4635,14 @@ packages:
       react: ^16.0.0 || ^17.0.0 || ^18.0.0
       react-dom: ^16.0.0 || ^17.0.0 || ^18.0.0

+  redis-errors@1.2.0:
+    resolution: {integrity: sha512-1qny3OExCf0UvUV/5wpYKf2YwPcOqXzkwKKSmKHiE6ZMQs5heeE/c8eXK+PNllPvmjgAbfnsbpkGZWy8cBpn9w==}
+    engines: {node: '>=4'}
+
+  redis-parser@3.0.0:
+    resolution: {integrity: sha512-DJnGAeenTdpMEH6uAJRK/uiyEIH9WVsUmoLwzudwGJUwZPp80PDBWPHXSAGNPwNvIXAbe7MSUB1zQFugFml66A==}
+    engines: {node: '>=4'}
+
   redux@4.2.1:
     resolution: {integrity: sha512-LAUYz4lc+Do8/g7aeRa8JkyDErK6ekstQaqWQrNRW//MY1TvCEpMtpTWvlQ+FPbWCx+Xixu/6SHt5N0HR+SB4w==}

@@ -4807,6 +4846,9 @@ packages:
     peerDependencies:
       svelte: ^4.0.0 || ^5.0.0-next.0

+  standard-as-callback@2.1.0:
+    resolution: {integrity: sha512-qoRRSyROncaz1z0mvYqIE4lCd9p2R90i6GxW3uZv5ucSu8tU7B5HXUP1gG8pVZsYNVaXjk8ClXHPttLyxAL48A==}
+
   stream-shift@1.0.3:
     resolution: {integrity: sha512-76ORR0DO1o1hlKwTbi/DM3EXWGf3ZJYO8cXX5RJwnul2DEg2oyoZyjLNoQM8WsvZiFKCRfC1O0J7iCvie3RZmQ==}

@@ -6006,7 +6048,7 @@ snapshots:
       '@babel/traverse': 7.27.0
       '@babel/types': 7.27.0
       convert-source-map: 2.0.0
-      debug: 4.4.0
+      debug: 4.4.0(supports-color@8.1.1)
       gensync: 1.0.0-beta.2
       json5: 2.2.3
       semver: 6.3.1
@@ -6113,7 +6155,7 @@ snapshots:
       '@babel/parser': 7.26.2
       '@babel/template': 7.25.9
       '@babel/types': 7.26.0
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       globals: 11.12.0
     transitivePeerDependencies:
       - supports-color
@@ -6125,7 +6167,7 @@ snapshots:
       '@babel/parser': 7.26.2
       '@babel/template': 7.25.9
       '@babel/types': 7.26.0
-      debug: 4.3.7(supports-color@5.5.0)
+      debug: 4.4.0(supports-color@5.5.0)
       globals: 11.12.0
     transitivePeerDependencies:
       - supports-color
@@ -6137,7 +6179,7 @@ snapshots:
       '@babel/parser': 7.27.0
       '@babel/template': 7.27.0
       '@babel/types': 7.27.0
-      debug: 4.4.0
+      debug: 4.4.0(supports-color@8.1.1)
       globals: 11.12.0
     transitivePeerDependencies:
       - supports-color
@@ -6218,7 +6260,7 @@ snapshots:
   '@eslint/config-array@0.18.0':
     dependencies:
       '@eslint/object-schema': 2.1.4
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       minimatch: 3.1.2
     transitivePeerDependencies:
       - supports-color
@@ -6228,7 +6270,7 @@ snapshots:
   '@eslint/eslintrc@3.1.0':
     dependencies:
       ajv: 6.12.6
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       espree: 10.3.0
       globals: 14.0.0
       ignore: 5.3.2
@@ -6420,6 +6462,8 @@ snapshots:
   '@img/sharp-win32-x64@0.33.5':
     optional: true

+  '@ioredis/commands@1.4.0': {}
+
   '@isaacs/cliui@8.0.2':
     dependencies:
       string-width: 5.1.2
@@ -7653,6 +7697,12 @@ snapshots:
     dependencies:
       '@types/node': 22.9.0

+  '@types/ioredis@5.0.0':
+    dependencies:
+      ioredis: 5.8.2
+    transitivePeerDependencies:
+      - supports-color
+
   '@types/json-schema@7.0.15': {}

   '@types/json5@0.0.29': {}
@@ -7736,7 +7786,7 @@ snapshots:
       '@typescript-eslint/types': 8.14.0
       '@typescript-eslint/typescript-estree': 8.14.0(typescript@5.6.3)
       '@typescript-eslint/visitor-keys': 8.14.0
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       eslint: 9.14.0(jiti@1.21.6)
     optionalDependencies:
       typescript: 5.6.3
@@ -7752,7 +7802,7 @@ snapshots:
     dependencies:
       '@typescript-eslint/typescript-estree': 8.14.0(typescript@5.6.3)
       '@typescript-eslint/utils': 8.14.0(eslint@9.14.0(jiti@1.21.6))(typescript@5.6.3)
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       ts-api-utils: 1.4.0(typescript@5.6.3)
     optionalDependencies:
       typescript: 5.6.3
@@ -7766,7 +7816,7 @@ snapshots:
     dependencies:
       '@typescript-eslint/types': 8.14.0
       '@typescript-eslint/visitor-keys': 8.14.0
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       fast-glob: 3.3.2
       is-glob: 4.0.3
       minimatch: 9.0.5
@@ -7885,7 +7935,7 @@ snapshots:

   agent-base@6.0.2:
     dependencies:
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
     transitivePeerDependencies:
       - supports-color

@@ -8297,6 +8347,8 @@ snapshots:

   clsx@2.1.1: {}

+  cluster-key-slot@1.1.2: {}
+
   cmdk@1.0.4(react-dom@19.0.0-rc-66855b96-20241106(react@19.0.0-rc-66855b96-20241106))(react@19.0.0-rc-66855b96-20241106)(types-react-dom@19.0.0-rc.1)(types-react@19.0.0-rc.1):
     dependencies:
       '@radix-ui/react-dialog': 1.1.2(react-dom@19.0.0-rc-66855b96-20241106(react@19.0.0-rc-66855b96-20241106))(react@19.0.0-rc-66855b96-20241106)(types-react-dom@19.0.0-rc.1)(types-react@19.0.0-rc.1)
@@ -8530,21 +8582,23 @@ snapshots:
     optionalDependencies:
       supports-color: 8.1.1

-  debug@4.3.7(supports-color@5.5.0):
+  debug@4.3.7(supports-color@8.1.1):
     dependencies:
       ms: 2.1.3
     optionalDependencies:
-      supports-color: 5.5.0
+      supports-color: 8.1.1

-  debug@4.3.7(supports-color@8.1.1):
+  debug@4.4.0(supports-color@5.5.0):
     dependencies:
       ms: 2.1.3
     optionalDependencies:
-      supports-color: 8.1.1
+      supports-color: 5.5.0

-  debug@4.4.0:
+  debug@4.4.0(supports-color@8.1.1):
     dependencies:
       ms: 2.1.3
+    optionalDependencies:
+      supports-color: 8.1.1

   decimal.js-light@2.5.1: {}

@@ -8581,6 +8635,8 @@ snapshots:

   delegates@1.0.0: {}

+  denque@2.1.0: {}
+
   dequal@2.0.3: {}

   detect-libc@2.0.3: {}
@@ -8811,7 +8867,7 @@ snapshots:
   eslint-import-resolver-typescript@3.6.3(@typescript-eslint/parser@8.14.0(eslint@9.14.0(jiti@1.21.6))(typescript@5.6.3))(eslint-import-resolver-node@0.3.9)(eslint-plugin-import@2.31.0)(eslint@9.14.0(jiti@1.21.6)):
     dependencies:
       '@nolyfill/is-core-module': 1.0.39
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       enhanced-resolve: 5.17.1
       eslint: 9.14.0(jiti@1.21.6)
       eslint-module-utils: 2.12.0(@typescript-eslint/parser@8.14.0(eslint@9.14.0(jiti@1.21.6))(typescript@5.6.3))(eslint-import-resolver-node@0.3.9)(eslint-import-resolver-typescript@3.6.3)(eslint@9.14.0(jiti@1.21.6))
@@ -9022,7 +9078,7 @@ snapshots:

   extract-zip@2.0.1(supports-color@8.1.1):
     dependencies:
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       get-stream: 5.2.0
       yauzl: 2.10.0
     optionalDependencies:
@@ -9331,7 +9387,7 @@ snapshots:
   https-proxy-agent@5.0.1:
     dependencies:
       agent-base: 6.0.2
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
     transitivePeerDependencies:
       - supports-color

@@ -9393,6 +9449,20 @@ snapshots:
     dependencies:
       loose-envify: 1.4.0

+  ioredis@5.8.2:
+    dependencies:
+      '@ioredis/commands': 1.4.0
+      cluster-key-slot: 1.1.2
+      debug: 4.4.0(supports-color@8.1.1)
+      denque: 2.1.0
+      lodash.defaults: 4.2.0
+      lodash.isarguments: 3.1.0
+      redis-errors: 1.2.0
+      redis-parser: 3.0.0
+      standard-as-callback: 2.1.0
+    transitivePeerDependencies:
+      - supports-color
+
   is-array-buffer@3.0.4:
     dependencies:
       call-bind: 1.0.7
@@ -9692,6 +9762,10 @@ snapshots:
     dependencies:
       p-locate: 5.0.0

+  lodash.defaults@4.2.0: {}
+
+  lodash.isarguments@3.1.0: {}
+
   lodash.merge@4.6.2: {}

   lodash.once@4.1.1: {}
@@ -9836,7 +9910,7 @@ snapshots:
   mqtt-packet@9.0.0:
     dependencies:
       bl: 6.0.16
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       process-nextick-args: 2.0.1
     transitivePeerDependencies:
       - supports-color
@@ -9847,7 +9921,7 @@ snapshots:
       '@types/ws': 8.5.13
       commist: 3.2.0
       concat-stream: 2.0.0
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       help-me: 5.0.0
       lru-cache: 10.4.3
       minimist: 1.2.8
@@ -9997,7 +10071,7 @@ snapshots:

   number-allocator@1.0.14:
     dependencies:
-      debug: 4.3.7(supports-color@8.1.1)
+      debug: 4.4.0(supports-color@8.1.1)
       js-sdsl: 4.3.0
     transitivePeerDependencies:
       - supports-color
@@ -10532,6 +10606,12 @@ snapshots:
       tiny-invariant: 1.3.3
       victory-vendor: 36.9.2

+  redis-errors@1.2.0: {}
+
+  redis-parser@3.0.0:
+    dependencies:
+      redis-errors: 1.2.0
+
   redux@4.2.1:
     dependencies:
       '@babel/runtime': 7.26.0
@@ -10781,6 +10861,8 @@ snapshots:
       svelte: 4.2.15
       swrev: 4.0.0

+  standard-as-callback@2.1.0: {}
+
   stream-shift@1.0.3: {}

   streamsearch@1.1.0: {}
diff --git a/prisma/schema.prisma b/prisma/schema.prisma
index 1edad07..820f9ac 100644
--- a/prisma/schema.prisma
+++ b/prisma/schema.prisma
@@ -93,6 +93,17 @@ model Organizations {
   usage             OrganizationUsage?
   auditLogs         AuditLog[]
   dataExports       DataExport[]
+
+  // AWMS Relations
+  awms_customers    awms_customers[]
+  awms_customer_segments awms_customer_segments[]
+  awms_vehicles     awms_vehicles[]
+  awms_service_types awms_service_types[]
+  awms_service_jobs awms_service_jobs[]
+  awms_quotes       awms_quotes[]
+  awms_invoices     awms_invoices[]
+  awms_payments     awms_payments[]
+  awms_appointments awms_appointments[]
 }

 // Organization Invitations Model
@@ -115,7 +126,6 @@ model OrganizationInvitations {

   @@index([organizationId])
   @@index([email])
-  @@index([token])
 }

 model crm_Accounts {
@@ -529,6 +539,7 @@ model Invoices {
   accounts                      crm_Accounts?   @relation(fields: [assigned_account_id], references: [id])
   connected_documents           String[]        @db.ObjectId
   documents                     Documents[]     @relation(fields: [connected_documents], references: [id])
+  awms_vehicle_service_history awms_vehicle_service_history[]
 }

 model invoice_States {
@@ -766,6 +777,23 @@ model Users {
   auditLogs            AuditLog[]
   sessions             UserSession[]
   dataExports          DataExport[]
+
+  // AWMS Relations
+  awms_customers_created     awms_customers[]                    @relation("awms_customers_created_by")
+  awms_customers_updated     awms_customers[]                    @relation("awms_customers_updated_by")
+  awms_communication_history awms_customer_communication_history[]
+  awms_notes_assigned        awms_customer_notes[]               @relation("awms_notes_assigned_to")
+  awms_notes_created         awms_customer_notes[]               @relation("awms_notes_created_by")
+  awms_vehicles_created      awms_vehicles[]                     @relation("awms_vehicles_created_by")
+  awms_vehicle_service_history awms_vehicle_service_history[]
+  awms_vehicle_recalls       awms_vehicle_recalls[]
+  awms_service_jobs_assigned awms_service_jobs[]
+  awms_service_jobs_qc       awms_service_jobs[]                 @relation("quality_checker")
+  awms_service_parts_used    awms_service_parts_used[]
+  awms_service_timesheets    awms_service_timesheets[]
+  awms_appointments          awms_appointments[]
+  awms_appointment_slots     awms_appointment_slots[]
+  awms_technician_availability awms_technician_availability[]
 }

 enum Language {
@@ -884,8 +912,6 @@ model OrganizationUsage {

   // Relations
   organization           Organizations       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
-
-  @@index([organizationId])
 }

 // Audit Actions Enum
@@ -949,7 +975,6 @@ model UserSession {
   user                   Users               @relation(fields: [userId], references: [id], onDelete: Cascade)

   @@index([userId])
-  @@index([token])
   @@index([isActive])
 }

@@ -989,3 +1014,764 @@ enum ExportStatus {
   FAILED
   EXPIRED
 }
+
+// AWMS CRM Module Enums
+enum awms_CustomerContactPreference {
+  EMAIL
+  SMS
+  PHONE
+  MAIL
+}
+
+enum awms_CustomerStatus {
+  NEW
+  ACTIVE
+  INACTIVE
+  DORMANT
+  AT_RISK
+  VIP
+  LOST
+}
+
+enum awms_CustomerLifecycleStage {
+  PROSPECT
+  CUSTOMER
+  REGULAR
+  LOYAL
+  LOST
+}
+
+enum awms_CommunicationType {
+  EMAIL
+  SMS
+  CALL
+  IN_PERSON
+  CHAT
+  REVIEW
+}
+
+enum awms_CommunicationDirection {
+  INBOUND
+  OUTBOUND
+}
+
+enum awms_Sentiment {
+  POSITIVE
+  NEUTRAL
+  NEGATIVE
+}
+
+enum awms_NoteType {
+  FOLLOW_UP
+  ISSUE
+  REMINDER
+  GENERAL
+}
+
+enum awms_NotePriority {
+  HIGH
+  NORMAL
+  LOW
+}
+
+// AWMS CRM Module Models
+model awms_customers {
+  id                            String                            @id @default(auto()) @map("_id") @db.ObjectId
+  organizationId                String                            @db.ObjectId
+  customer_number               String                            @unique
+  first_name                    String
+  last_name                     String
+  email                         String
+  phone_primary                 String?
+  phone_mobile                  String?
+  date_of_birth                 DateTime?                         @db.Date
+  gender                        String?
+  address_line1                 String?
+  address_line2                 String?
+  suburb                        String?
+  state                         String?
+  postcode                      String?
+  country                       String?
+  contact_preference            awms_CustomerContactPreference    @default(EMAIL)
+  communication_opted_in        Boolean                           @default(true)
+  status                        awms_CustomerStatus               @default(NEW)
+  lifecycle_stage               awms_CustomerLifecycleStage       @default(PROSPECT)
+  lifetime_value                Float                             @default(0)
+  total_spent                   Float                             @default(0)
+  service_count                 Int                               @default(0)
+  last_service_date             DateTime?                         @db.Date
+  last_contact_date             DateTime?                         @db.Date
+  average_service_interval_days Int?
+  loyalty_member_id             String?
+  notes                         String?
+  createdAt                     DateTime                          @default(now()) @db.Date
+  updatedAt                     DateTime                          @updatedAt @db.Date
+  created_by_id                 String                            @db.ObjectId
+  updated_by_id                 String?                           @db.ObjectId
+
+  // Relations
+  organization                  Organizations                     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
+  created_by                    Users                             @relation(name: "awms_customers_created_by", fields: [created_by_id], references: [id], onDelete: NoAction)
+  updated_by                    Users?                            @relation(name: "awms_customers_updated_by", fields: [updated_by_id], references: [id], onDelete: NoAction)
+  segmentation                  awms_customer_segmentation[]
+  communication_history         awms_customer_communication_history[]
+  customer_notes                awms_customer_notes[]
+  vehicles                      awms_vehicles[]
+  service_jobs                  awms_service_jobs[]
+  quotes                        awms_quotes[]
+  invoices                      awms_invoices[]
+  accounts_receivable           awms_accounts_receivable[]
+  appointments                  awms_appointments[]
+
+  @@unique([organizationId, email])
+  @@index([organizationId])
+}
+
+model awms_customer_segmentation {
+  id              String                    @id @default(auto()) @map("_id") @db.ObjectId
+  customer_id     String                    @db.ObjectId
+  segment_id      String                    @db.ObjectId
+  assigned_date   DateTime                  @default(now()) @db.Date
+  auto_assigned   Boolean                   @default(true)
+  updatedAt       DateTime                  @updatedAt @db.Date
+
+  // Relations
+  customer        awms_customers            @relation(fields: [customer_id], references: [id], onDelete: Cascade)
+  segment         awms_customer_segments    @relation(fields: [segment_id], references: [id], onDelete: Cascade)
+
+  @@index([customer_id])
+  @@index([segment_id])
+}
+
+model awms_customer_communication_history {
+  id                String                      @id @default(auto()) @map("_id") @db.ObjectId
+  customer_id       String                      @db.ObjectId
+  type              awms_CommunicationType
+  direction         awms_CommunicationDirection
+  subject           String?
+  summary           String?
+  content           String?
+  communication_date DateTime                   @default(now()) @db.Date
+  recipient_email   String?
+  recipient_phone   String?
+  sender_id         String?                     @db.ObjectId
+  engagement_status String?
+  sentiment         awms_Sentiment?
+  attachment_urls   String[]
+  external_id       String?
+  createdAt         DateTime                    @default(now()) @db.Date
+  updatedAt         DateTime                    @updatedAt @db.Date
+
+  // Relations
+  customer          awms_customers              @relation(fields: [customer_id], references: [id], onDelete: Cascade)
+  sender            Users?                      @relation(fields: [sender_id], references: [id], onDelete: SetNull)
+
+  @@index([customer_id])
+}
+
+model awms_customer_notes {
+  id              String            @id @default(auto()) @map("_id") @db.ObjectId
+  customer_id     String            @db.ObjectId
+  note_type       awms_NoteType     @default(GENERAL)
+  priority        awms_NotePriority @default(NORMAL)
+  content         String
+  assigned_to_id  String?           @db.ObjectId
+  reminder_date   DateTime?         @db.Date
+  createdAt       DateTime          @default(now()) @db.Date
+  created_by_id   String            @db.ObjectId
+
+  // Relations
+  customer        awms_customers    @relation(fields: [customer_id], references: [id], onDelete: Cascade)
+  assigned_to     Users?            @relation(name: "awms_notes_assigned_to", fields: [assigned_to_id], references: [id], onDelete: SetNull)
+  created_by      Users             @relation(name: "awms_notes_created_by", fields: [created_by_id], references: [id], onDelete: NoAction)
+
+  @@index([customer_id])
+}
+
+model awms_customer_segments {
+  id            String                        @id @default(auto()) @map("_id") @db.ObjectId
+  organizationId String                       @db.ObjectId
+  segment_name  String
+  criteria_json String?
+  member_count  Int                           @default(0)
+  is_active     Boolean                       @default(true)
+  createdAt     DateTime                      @default(now()) @db.Date
+  updatedAt     DateTime                      @updatedAt @db.Date
+
+  // Relations
+  organization  Organizations                 @relation(fields: [organizationId], references: [id], onDelete: Cascade)
+  customers     awms_customer_segmentation[]
+
+  @@index([organizationId])
+}
+
+// AWMS Vehicles Module Enums
+enum awms_VehicleStatus {
+  ACTIVE
+  ARCHIVED
+  SOLD
+}
+
+enum awms_ServiceType {
+  OIL_CHANGE
+  INSPECTION
+  BRAKES
+  TIRES
+  ENGINE
+  OTHER
+}
+
+enum awms_RecallSafetyLevel {
+  MINOR
+  MAJOR
+  CRITICAL
+}
+
+enum awms_RecallRepairStatus {
+  OPEN
+  IN_PROGRESS
+  COMPLETED
+}
+
+// AWMS Vehicles Module Models
+model awms_vehicles {
+  id                      String                        @id @default(auto()) @map("_id") @db.ObjectId
+  organizationId          String                        @db.ObjectId
+  customer_id             String                        @db.ObjectId
+  vehicle_number          String
+  registration_number     String                        @unique
+  registration_expiry_date DateTime?                    @db.Date
+  vin                     String?
+  make                    String?
+  model                   String?
+  year                    Int?
+  color                   String?
+  body_type               String?
+  transmission            String?
+  drivetrain              String?
+  fuel_type               String?
+  engine_size_cc          Int?
+  horsepower              Int?
+  torque                  Int?
+  curb_weight             Int?
+  fuel_tank_capacity      Int?
+  cargo_capacity          Int?
+  passenger_capacity      Int?
+  service_capacity_liters Int?
+  current_odometer_km     Int?
+  last_service_date       DateTime?                     @db.Date
+  next_service_due_date   DateTime?                     @db.Date
+  last_odometer_reading   Int?
+  is_primary_vehicle      Boolean                       @default(false)
+  status                  awms_VehicleStatus            @default(ACTIVE)
+  purchased_date          DateTime?                     @db.Date
+  warranty_expiry_date    DateTime?                     @db.Date
+  notes                   String?
+  createdAt               DateTime                      @default(now()) @db.Date
+  updatedAt               DateTime                      @updatedAt @db.Date
+  created_by_id           String                        @db.ObjectId
+
+  // Relations
+  organization            Organizations                 @relation(fields: [organizationId], references: [id], onDelete: Cascade)
+  customer                awms_customers                @relation(fields: [customer_id], references: [id], onDelete: Cascade)
+  created_by              Users                         @relation(name: "awms_vehicles_created_by", fields: [created_by_id], references: [id], onDelete: NoAction)
+  service_history         awms_vehicle_service_history[]
+  recalls                 awms_vehicle_recalls[]
+  maintenance_schedule    awms_vehicle_maintenance_schedule[]
+  service_jobs            awms_service_jobs[]
+  quotes                  awms_quotes[]
+  appointments            awms_appointments[]
+
+  @@unique([organizationId, customer_id, vehicle_number])
+  @@index([organizationId])
+  @@index([customer_id])
+}
+
+model awms_vehicle_service_history {
+  id                    String            @id @default(auto()) @map("_id") @db.ObjectId
+  vehicle_id            String            @db.ObjectId
+  service_date          DateTime          @db.Date
+  service_type          awms_ServiceType
+  odometer_km_at_service Int
+  labor_hours           Float?
+  labor_cost            Float?
+  parts_cost            Float?
+  total_cost            Float
+  technician_id         String?           @db.ObjectId
+  technician_notes      String?
+  customer_notes        String?
+  invoice_id            String?           @db.ObjectId
+  is_warranty_work      Boolean           @default(false)
+  updatedAt             DateTime          @updatedAt @db.Date
+
+  // Relations
+  vehicle               awms_vehicles     @relation(fields: [vehicle_id], references: [id], onDelete: Cascade)
+  technician            Users?            @relation(fields: [technician_id], references: [id], onDelete: SetNull)
+  invoice               Invoices?         @relation(fields: [invoice_id], references: [id], onDelete: SetNull)
+
+  @@index([vehicle_id])
+}
+
+// AWMS Finance Module Enums
+enum awms_QuoteStatus {
+  DRAFT
+  SENT
+  ACCEPTED
+  DECLINED
+  EXPIRED
+}
+
+enum awms_LineItemType {
+  LABOR
+  PARTS
+  FEE
+}
+
+enum awms_InvoiceStatus {
+  DRAFT
+  SENT
+  PARTIAL
+  PAID
+  OVERDUE
+  CANCELLED
+}
+
+enum awms_TaxCode {
+  STANDARD
+  GST_FREE
+}
+
+enum awms_PaymentMethod {
+  CARD
+  TRANSFER
+  DIRECT_DEBIT
+  CASH
+  CHECK
+}
+
+enum awms_PaymentStatus {
+  PENDING
+  PROCESSED
+  FAILED
+  REFUNDED
+}
+
+enum awms_ARStatus {
+  CURRENT
+  OVERDUE_30
+  OVERDUE_60
+  OVERDUE_90
+}
+
+// AWMS Bookings Module Enums
+enum awms_AppointmentStatus {
+  SCHEDULED
+  CONFIRMED
+  IN_PROGRESS
+  COMPLETED
+  NO_SHOW
+  CANCELLED
+}
+
+enum awms_SlotStatus {
+  AVAILABLE
+  BLOCKED
+  APPOINTMENT
+}
+
+// AWMS Finance Module Models
+model awms_quotes {
+  id                   String           @id @default(auto()) @map("_id") @db.ObjectId
+  organizationId       String           @db.ObjectId
+  quote_number         String           @unique
+  customer_id          String           @db.ObjectId
+  vehicle_id           String           @db.ObjectId
+  quote_date           DateTime         @default(now()) @db.Date
+  expiration_date      DateTime?        @db.Date
+  status               awms_QuoteStatus @default(DRAFT)
+  subtotal             Float
+  discount_amount      Float?
+  discount_percentage  Float?
+  tax_amount           Float
+  total_amount         Float
+  notes                String?
+  createdAt            DateTime         @default(now()) @db.Date
+  updatedAt            DateTime         @updatedAt @db.Date
+
+  // Relations
+  organization         Organizations    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
+  customer             awms_customers   @relation(fields: [customer_id], references: [id], onDelete: Cascade)
+  vehicle              awms_vehicles    @relation(fields: [vehicle_id], references: [id], onDelete: Cascade)
+  line_items           awms_quote_line_items[]
+  invoice              awms_invoices[]
+
+  @@index([organizationId])
+  @@index([customer_id])
+  @@index([vehicle_id])
+}
+
+model awms_quote_line_items {
+  id             String            @id @default(auto()) @map("_id") @db.ObjectId
+  quote_id       String            @db.ObjectId
+  line_item_type awms_LineItemType
+  description    String
+  quantity       Float
+  unit_price     Float
+  total_price    Float
+  sequence_order Int?
+  notes          String?
+
+  // Relations
+  quote          awms_quotes       @relation(fields: [quote_id], references: [id], onDelete: Cascade)
+
+  @@index([quote_id])
+}
+
+model awms_invoices {
+  id                  String             @id @default(auto()) @map("_id") @db.ObjectId
+  organizationId      String             @db.ObjectId
+  invoice_number      String             @unique
+  customer_id         String             @db.ObjectId
+  quote_id            String?            @db.ObjectId
+  job_id              String?            @db.ObjectId
+  invoice_date        DateTime           @default(now()) @db.Date
+  due_date            DateTime?          @db.Date
+  subtotal            Float
+  discount_amount     Float?
+  tax_amount          Float
+  total_amount        Float
+  paid_amount         Float              @default(0)
+  status              awms_InvoiceStatus @default(DRAFT)
+  payment_terms       String?
+  notes               String?
+  createdAt           DateTime           @default(now()) @db.Date
+  updatedAt           DateTime           @updatedAt @db.Date
+
+  // Relations
+  organization        Organizations      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
+  customer            awms_customers     @relation(fields: [customer_id], references: [id], onDelete: Cascade)
+  quote               awms_quotes?       @relation(fields: [quote_id], references: [id], onDelete: SetNull)
+  job                 awms_service_jobs? @relation(fields: [job_id], references: [id], onDelete: SetNull)
+  line_items          awms_invoice_line_items[]
+  payments            awms_payments[]
+  accounts_receivable awms_accounts_receivable[]
+
+  @@index([organizationId])
+  @@index([customer_id])
+}
+
+model awms_invoice_line_items {
+  id             String       @id @default(auto()) @map("_id") @db.ObjectId
+  invoice_id     String       @db.ObjectId
+  description    String
+  quantity       Float
+  unit_price     Float
+  total_price    Float
+  tax_code       awms_TaxCode @default(STANDARD)
+  sequence_order Int?
+
+  // Relations
+  invoice        awms_invoices @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
+
+  @@index([invoice_id])
+}
+
+model awms_payments {
+  id             String           @id @default(auto()) @map("_id") @db.ObjectId
+  organizationId String           @db.ObjectId
+  invoice_id     String           @db.ObjectId
+  payment_method awms_PaymentMethod
+  payment_date   DateTime         @default(now()) @db.Date
+  amount         Float
+  reference      String?
+  status         awms_PaymentStatus @default(PENDING)
+  receipt_number String?
+  notes          String?
+  createdAt      DateTime         @default(now()) @db.Date
+  processed_at   DateTime?        @db.Date
+
+  // Relations
+  organization   Organizations    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
+  invoice        awms_invoices    @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
+
+  @@index([organizationId])
+  @@index([invoice_id])
+}
+
+model awms_accounts_receivable {
+  id                 String       @id @default(auto()) @map("_id") @db.ObjectId
+  invoice_id         String       @db.ObjectId
+  customer_id        String       @db.ObjectId
+  original_amount    Float
+  paid_amount        Float
+  outstanding_amount Float
+  days_overdue       Int
+  status             awms_ARStatus
+  last_payment_date  DateTime?    @db.Date
+  last_follow_up_date DateTime?   @db.Date
+
+  // Relations
+  invoice            awms_invoices @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
+  customer           awms_customers @relation(fields: [customer_id], references: [id], onDelete: Cascade)
+
+  @@index([invoice_id])
+  @@index([customer_id])
+}
+
+// AWMS Bookings Module Models
+model awms_appointments {
+  id                     String                 @id @default(auto()) @map("_id") @db.ObjectId
+  organizationId         String                 @db.ObjectId
+  customer_id            String                 @db.ObjectId
+  vehicle_id             String                 @db.ObjectId
+  appointment_number     String?
+  appointment_date_time  DateTime
+  duration_minutes       Int
+  service_type_id        String                 @db.ObjectId
+  assigned_technician_id String?                @db.ObjectId
+  status                 awms_AppointmentStatus @default(SCHEDULED)
+  customer_comments      String?
+  special_requests       String?
+  reminder_sent          Boolean                @default(false)
+  reminder_sent_date     DateTime?              @db.Date
+  createdAt              DateTime               @default(now()) @db.Date
+  updatedAt              DateTime               @updatedAt @db.Date
+  cancelled_at           DateTime?              @db.Date
+
+  // Relations
+  organization           Organizations          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
+  customer               awms_customers         @relation(fields: [customer_id], references: [id], onDelete: Cascade)
+  vehicle                awms_vehicles          @relation(fields: [vehicle_id], references: [id], onDelete: Cascade)
+  service_type           awms_service_types     @relation(fields: [service_type_id], references: [id], onDelete: NoAction)
+  assigned_technician    Users?                 @relation(fields: [assigned_technician_id], references: [id], onDelete: SetNull)
+  slot                   awms_appointment_slots?
+
+  @@index([organizationId])
+  @@index([customer_id])
+  @@index([vehicle_id])
+}
+
+model awms_appointment_slots {
+  id            String          @id @default(auto()) @map("_id") @db.ObjectId
+  technician_id String          @db.ObjectId
+  date          DateTime        @db.Date
+  start_time    DateTime
+  end_time      DateTime
+  slot_status   awms_SlotStatus @default(AVAILABLE)
+  appointment_id String?         @db.ObjectId @unique
+
+  // Relations
+  technician    Users           @relation(fields: [technician_id], references: [id], onDelete: Cascade)
+  appointment   awms_appointments? @relation(fields: [appointment_id], references: [id], onDelete: SetNull)
+
+  @@index([technician_id])
+}
+
+model awms_technician_availability {
+  id            String   @id @default(auto()) @map("_id") @db.ObjectId
+  technician_id String   @db.ObjectId
+  day_of_week   Int
+  start_time    String
+  end_time      String
+  is_active     Boolean  @default(true)
+  updatedAt     DateTime @updatedAt @db.Date
+
+  // Relations
+  technician    Users    @relation(fields: [technician_id], references: [id], onDelete: Cascade)
+
+  @@index([technician_id])
+}
+
+// AWMS Service Module Enums
+enum awms_SkillLevel {
+  BASIC
+  INTERMEDIATE
+  ADVANCED
+}
+
+enum awms_JobPriority {
+  ROUTINE
+  URGENT
+  EMERGENCY
+}
+
+enum awms_JobStatus {
+  NEW
+  IN_PROGRESS
+  PENDING_APPROVAL
+  COMPLETE
+  CLOSED
+}
+
+enum awms_QCStatus {
+  PENDING
+  PASSED
+  FAILED
+}
+
+enum awms_JobDetailStatus {
+  PLANNED
+  IN_PROGRESS
+  COMPLETE
+}
+
+// AWMS Service Module Models
+model awms_service_types {
+  id                   String            @id @default(auto()) @map("_id") @db.ObjectId
+  organizationId       String            @db.ObjectId
+  category_id          String?           @db.ObjectId
+  service_name         String
+  description          String?
+  standard_labor_rate  Float
+  standard_duration_hours Float
+  required_skill_level awms_SkillLevel   @default(BASIC)
+  parts_list           Json?
+  is_warranty_eligible Boolean           @default(false)
+  createdAt            DateTime          @default(now()) @db.Date
+  updatedAt            DateTime          @updatedAt @db.Date
+
+  // Relations
+  organization         Organizations     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
+  jobs                 awms_service_jobs[]
+  appointments         awms_appointments[]
+
+  @@index([organizationId])
+}
+
+model awms_service_jobs {
+  id                      String             @id @default(auto()) @map("_id") @db.ObjectId
+  organizationId          String             @db.ObjectId
+  job_number              String             @unique
+  customer_id             String             @db.ObjectId
+  vehicle_id              String             @db.ObjectId
+  appointment_id          String?            @db.ObjectId
+  service_type_id         String             @db.ObjectId
+  priority                awms_JobPriority   @default(ROUTINE)
+  status                  awms_JobStatus     @default(NEW)
+  assigned_technician_id  String?            @db.ObjectId
+  assigned_date           DateTime?          @db.Date
+  estimated_hours         Float?
+  actual_hours            Float?
+  estimated_cost          Float?
+  actual_cost             Float?
+  customer_concerns       String?
+  technician_notes        String?
+  additional_issues_found Boolean            @default(false)
+  quality_check_status    awms_QCStatus      @default(PENDING)
+  quality_checker_id      String?            @db.ObjectId
+  quality_notes           String?
+  createdAt               DateTime           @default(now()) @db.Date
+  started_at              DateTime?          @db.Date
+  completed_at            DateTime?          @db.Date
+  updatedAt               DateTime           @updatedAt @db.Date
+
+  // Relations
+  organization            Organizations      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
+  customer                awms_customers     @relation(fields: [customer_id], references: [id], onDelete: Cascade)
+  vehicle                 awms_vehicles      @relation(fields: [vehicle_id], references: [id], onDelete: Cascade)
+  service_type            awms_service_types @relation(fields: [service_type_id], references: [id], onDelete: NoAction)
+  assigned_technician     Users?             @relation(fields: [assigned_technician_id], references: [id], onDelete: SetNull)
+  quality_checker         Users?             @relation(name: "quality_checker", fields: [quality_checker_id], references: [id], onDelete: SetNull)
+  details                 awms_service_job_details[]
+  parts_used              awms_service_parts_used[]
+  timesheets              awms_service_timesheets[]
+  invoices                awms_invoices[]
+
+  @@index([organizationId])
+  @@index([customer_id])
+  @@index([vehicle_id])
+}
+
+model awms_service_job_details {
+  id             String               @id @default(auto()) @map("_id") @db.ObjectId
+  service_job_id String               @db.ObjectId
+  line_item_id   String
+  description    String
+  quantity       Float
+  unit_price     Float
+  total_price    Float
+  status         awms_JobDetailStatus @default(PLANNED)
+  updatedAt      DateTime             @updatedAt @db.Date
+
+  // Relations
+  service_job    awms_service_jobs    @relation(fields: [service_job_id], references: [id], onDelete: Cascade)
+
+  @@index([service_job_id])
+}
+
+model awms_service_parts_used {
+  id            String    @id @default(auto()) @map("_id") @db.ObjectId
+  service_job_id String   @db.ObjectId
+  part_id       String
+  quantity_used Int
+  unit_cost     Float
+  total_cost    Float
+  serial_number String?
+  logged_at     DateTime  @default(now()) @db.Date
+  logged_by_id  String    @db.ObjectId
+
+  // Relations
+  service_job   awms_service_jobs @relation(fields: [service_job_id], references: [id], onDelete: Cascade)
+  logged_by     Users             @relation(fields: [logged_by_id], references: [id], onDelete: NoAction)
+
+  @@index([service_job_id])
+}
+
+model awms_service_timesheets {
+  id                     String    @id @default(auto()) @map("_id") @db.ObjectId
+  service_job_id         String    @db.ObjectId
+  technician_id          String    @db.ObjectId
+  start_time             DateTime
+  end_time               DateTime?
+  break_duration_minutes Int?
+  billable_hours         Float?
+  task_description       String?
+  createdAt              DateTime  @default(now()) @db.Date
+
+  // Relations
+  service_job            awms_service_jobs @relation(fields: [service_job_id], references: [id], onDelete: Cascade)
+  technician             Users             @relation(fields: [technician_id], references: [id], onDelete: NoAction)
+
+  @@index([service_job_id])
+}
+
+model awms_vehicle_recalls {
+  id                 String                 @id @default(auto()) @map("_id") @db.ObjectId
+  vehicle_id         String                 @db.ObjectId
+  recall_number      String
+  recall_date        DateTime               @db.Date
+  description        String
+  safety_level       awms_RecallSafetyLevel
+  manufacturer       String
+  repair_status      awms_RecallRepairStatus @default(OPEN)
+  repair_date        DateTime?              @db.Date
+  repair_notes       String?
+  technician_id      String?                @db.ObjectId
+  external_recall_id String?
+  updatedAt          DateTime               @updatedAt @db.Date
+
+  // Relations
+  vehicle            awms_vehicles          @relation(fields: [vehicle_id], references: [id], onDelete: Cascade)
+  technician         Users?                 @relation(fields: [technician_id], references: [id], onDelete: SetNull)
+
+  @@index([vehicle_id])
+}
+
+model awms_vehicle_maintenance_schedule {
+  id                       String    @id @default(auto()) @map("_id") @db.ObjectId
+  vehicle_id               String    @db.ObjectId
+  service_type             String
+  interval_months          Int?
+  interval_km              Int?
+  last_performed_date      DateTime? @db.Date
+  next_due_date            DateTime? @db.Date
+  estimated_cost           Float?
+  estimated_duration_hours Float?
+  last_performed_odometer  Int?
+  notes                    String?
+
+  // Relations
+  vehicle                  awms_vehicles @relation(fields: [vehicle_id], references: [id], onDelete: Cascade)
+
+  @@index([vehicle_id])
+}
